<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="edu.nf.shopping.order.dao.OrderDao">

    <resultMap id="orderMap" type="edu.nf.shopping.order.entity.OrderInfo">
        <id property="orderId" column="order_id"/>
        <result property="buyPrice" column="buy_price"/>
        <result property="cheapPrice" column="cheap_price"/>
        <result property="transportPrice" column="transport_price"/>
        <result property="createTime" column="create_time"/>
        <result property="payTime" column="pay_time"/>
        <result property="deliverTime" column="deliver_time"/>
        <result property="dealTime" column="deal_time"/>
        <result property="buyRemark" column="buy_remark"/>
        <result property="orderRemark" column="order_remark"/>
        <result property="orderState" column="order_state"/>
        <result property="cargoIds" column="cargo_id"/>
        <association property="buyAdmin" resultMap="staffInfoMap"/>
        <association property="buyUser" resultMap="userInfoMap"/>
        <association property="userAddress" resultMap="userAddressMap"/>
    </resultMap>

    <resultMap id="staffInfoMap" type="edu.nf.shopping.admin.entity.StaffInfo">
        <id property="staffId" column="s_id"/>
        <result property="staffTel" column="s_tel"/>
        <result property="staffMoney" column="s_money"/>
        <result property="joinTime" column="join_time"/>
        <result property="outTime" column="out_time"/>
        <association property="staffType" resultMap="staffTypeMap"/>
        <association property="departmentInfo" resultMap="departmentInfoMap"/>
        <association property="user" resultMap="userInfoMap"/>
        <association property="staffState" resultMap="staffStateMap"/>
    </resultMap>
    <resultMap id="staffTypeMap" type="edu.nf.shopping.admin.entity.StaffType">
        <id property="stId" column="st_id"/>
        <result property="stName" column="st_name"/>
    </resultMap>
    <resultMap id="departmentInfoMap" type="edu.nf.shopping.admin.entity.DepartmentInfo">
        <id property="dpmentId" column="dpment_id"/>
    </resultMap>
    <resultMap id="staffStateMap" type="edu.nf.shopping.admin.entity.StaffState">
        <id property="stateId" column="ss_id"/>
        <result property="stateName" column="ss_name"/>
    </resultMap>

    <resultMap id="userInfoMap" type="edu.nf.shopping.user.entity.UserInfo">
        <id property="userId" column="u_id"/>
        <result property="userName" column="u_name"/>
        <result property="userEmail" column="u_email"/>
        <result property="tel" column="u_tel"/>
        <result property="password" column="u_password"/>
        <result property="sex" column="u_sex"/>
        <result property="realName" column="real_name"/>
        <result property="carNumber" column="card_num"/>
        <association property="face" resultMap="userFaceMap"/>
    </resultMap>
    <resultMap id="userFaceMap" type="edu.nf.shopping.user.entity.UserFace">
        <id property="faceId" column="face_id"/>
        <result property="faceFile" column="face_file"/>
        <result property="joinDate" column="join_date"/>
    </resultMap>

    <resultMap id="userAddressMap" type="edu.nf.shopping.user.entity.UserAddress">
        <id property="addressId" column="address_id"/>
        <result property="addressName" column="address_name"/>
        <result property="isSel" column="is_sel"/>
        <result property="addressTel" column="address_tel"/>
        <result property="addressUser" column="address_user"/>
        <association property="city" resultMap="cityMap"/>
    </resultMap>
    <resultMap id="cityMap" type="edu.nf.shopping.warehouse.entity.City">
        <id property="cid" column="c_id"/>
        <result property="cname" column="c_name"/>
        <result property="pid" column="p_id"/>
        <result property="type" column="type"/>
    </resultMap>

    <select id="listOrderInfo" resultMap="orderMap">
        select oi.order_id, oi.buy_price, oi.cheap_price, oi.transport_price,
        oi.create_time, oi.pay_time, oi.deliver_time, oi.deal_time, oi.buy_remark,
        oi.order_remark, oi.order_state, si.s_id, st.st_id, ss.ss_id,
        di.dpment_id, ui.u_id, uf.face_id, uf.face_file, ua.address_id, ua.address_name,
        ua.address_tel, ua.address_user, ua.is_sel, c.c_id, c.c_name, c.p_id, c.type from order_info oi
        left join staff_info si on si.s_id = oi.buy_admin
        left join user_info ui on ui.u_id = oi.buy_user
        left join user_address ua on ua.address_id = oi.address_id
        left join staff_type st on st.st_id = si.st_id
        left join department_info di on di.dpment_id = si.dpment_id
        left join staff_state ss on ss.ss_id = si.ss_id
        left join user_face uf on uf.face_id = ui.face_id
        left join city c on c.c_id = ua.address_region where ui.u_id = #{userId}
    </select>
    <select id="getOrderInfoByOrderId" resultMap="orderMap">
        select oi.order_id, oi.buy_price, oi.cheap_price, oi.transport_price,
        oi.create_time, oi.pay_time, oi.deliver_time, oi.deal_time, oi.buy_remark,
        oi.order_remark, oi.order_state, si.s_id, st.st_id, ss.ss_id,
        di.dpment_id, ui.u_id, uf.face_id, uf.face_file, ua.address_id, ua.address_name,
        ua.address_tel, ua.address_user, ua.is_sel, c.c_id, c.c_name, c.p_id, c.type from order_info oi
        left join staff_info si on si.s_id = oi.buy_admin
        left join user_info ui on ui.u_id = oi.buy_user
        left join user_address ua on ua.address_id = oi.address_id
        left join staff_type st on st.st_id = si.st_id
        left join department_info di on di.dpment_id = si.dpment_id
        left join staff_state ss on ss.ss_id = si.ss_id
        left join user_face uf on uf.face_id = ui.face_id
        left join city c on c.c_id = ua.address_region where oi.order_id = #{orderId}
    </select>
    <insert id="addOrderInfo" parameterType="edu.nf.shopping.order.entity.OrderInfo">
        insert order_info(order_id, cargo_id, buy_price, cheap_price, transport_price,
        create_time, pay_time, deliver_time, deal_time, buy_admin, buy_user, address_id,
        buy_remark, order_remark, order_state)
        value(#{orderInfo.orderId}, #{orderInfo.cargoIds}, #{orderInfo.buyPrice},
        #{orderInfo.cheapPrice}, #{orderInfo.transportPrice}, #{orderInfo.createTime},
        #{orderInfo.payTime}, #{orderInfo.deliverTime}, #{orderInfo.dealTime},
        #{orderInfo.buyAdmin.staffId}, #{orderInfo.buyUser.userId}, #{orderInfo.userAddress.addressId},
        #{orderInfo.buyRemark}, #{orderInfo.orderRemark}, #{orderInfo.orderState})
    </insert>
    <update id="updateOrderInfo" parameterType="edu.nf.shopping.order.entity.OrderInfo">
        update order_info set cargo_id = #{orderInfo.cargoIds}, buy_price = #{orderInfo.buyPrice},
        cheap_price = #{orderInfo.cheapPrice}, transport_price = #{orderInfo.transportPrice},
        pay_time = #{orderInfo.payTime}, deliver_time = #{orderInfo.deliverTime},
        deal_time = #{orderInfo.dealTime}, buy_admin = #{orderInfo.buyAdmin.staffId},
        address_id = #{orderInfo.userAddress.addressId}, buy_remark = #{orderInfo.buyRemark},
        order_remark = #{orderInfo.orderRemark}, order_state = #{orderInfo.orderState}
    </update>
    <delete id="deleteOrderInfo" parameterType="java.lang.String">
        delete from order_info where order_id = #{orderId}
    </delete>

</mapper>